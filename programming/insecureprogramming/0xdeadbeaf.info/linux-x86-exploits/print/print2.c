/*
 * $Id: print2.c,v 1.1.1.1 2004/05/29 14:15:05 raptor Exp $
 *
 * print2.c - vulnerable program (printable shellcode)
 * Copyright (c) 2004 Marco Ivaldi <raptor@0xdeadbeef.info>
 *
 * This is the cleared_stack.c code by Jon Erickson <matrix@phiral.com>.
 */

void func(char *data)
{
	char buffer[5];
	strcpy(buffer, data);
}

int main(int argc, char **argv, char **envp)
{
	int i;

	// clearing out the stack memory
	// clearing all arguments except the first
	memset(argv[0], 0, strlen(argv[0]));
	for (i = 2; argv[i] != 0; i++)
		memset(argv[i], 0, strlen(argv[i]));
	// clearing all environment variables
	for (i = 0; envp[i] != 0; i++)
		memset(envp[i], 0, strlen(envp[i]));

	// if the first argument is too long, exit
	if (strlen(argv[1]) > 40) {
		printf("first arg is too long\n");
		exit(1);
	}
	printf("arg1 is at %p\n", argv[1]);

	func(argv[1]);
	return(0);
}
